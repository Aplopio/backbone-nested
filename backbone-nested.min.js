/**
 * Backbone Nested Models
 * Author: Bret Little
 * Version: 0.3
 *
 * Nested model support in Backbone.js
 *
 **/
(function(c){var b=c.Model,a=c.Collection;c.Model.prototype.setRelation=function(d,h){var f=this.attributes[d],e,i=[],g=[];if(_.has(this.relations,d)){if(f&&f instanceof a){if(h instanceof a||h instanceof Array){h=h.models||h;i=_.clone(h);f.each(function(j,k){var l=_.find(h,function(m){return m.id===j.id});if(l){j.set(l.toJSON?l.toJSON():l);i.splice(k,1)}else{g.push(j)}});_.each(g,function(j){f.remove(j)});f.add(i)}else{f.each(function(j){if(h.id===j.id){j.set(h)}else{f.remove(j)}})}return f}if(f&&f instanceof b){f.set(h);return f}h=new this.relations[d](h);h.parent=this}return h};c.Model.prototype.set=function(i,k,h){var d,g;if(i==null){return this}if(_.isObject(i)){g=i;h=k}else{(g={})[i]=k}var e=h&&h.silent;var j=h&&h.unset;if(!this._validate(g,h)){return false}if(this.idAttribute in g){this.id=g[this.idAttribute]}var f=this.attributes;for(d in g){k=g[d];k=this.setRelation(d,k);j?delete f[d]:f[d]=k;this._changes.push(d,k)}this._hasComputed=false;if(!e){this.change(h)}return this}})(Backbone);
